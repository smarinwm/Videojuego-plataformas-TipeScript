{"code":"import { __extends } from \"tslib\";\r\nimport Constantes from '../constantes';\r\nimport Jugador from '../gameobjects/jugador';\r\nimport Enemigos from '../gameobjects/enemigos';\r\nimport PlataformasMoviles from '../gameobjects/plataformasmoviles';\r\nimport Recolectables from '../gameobjects/recolectables';\r\nimport GestorBD from '../basedatos/gestorbd';\r\nvar ManejadorNivel = /** @class */ (function (_super) {\r\n    __extends(ManejadorNivel, _super);\r\n    function ManejadorNivel(nivel) {\r\n        var _this = _super.call(this, nivel) || this;\r\n        _this.nombreNivel = nivel;\r\n        return _this;\r\n    }\r\n    ManejadorNivel.prototype.init = function () {\r\n        this.vidas = 3;\r\n        this.puntuacion = 0;\r\n        this.numObjetosRecolectar = 0;\r\n        this.segundos = 1;\r\n        this.tiempoRestante = 300;\r\n        this.tiempoAgotado = false;\r\n        this.registry.set(Constantes.REGISTRO.VIDAS, this.vidas);\r\n        this.registry.set(Constantes.REGISTRO.PUNTUACION, this.puntuacion);\r\n        this.grupoEnemigos = [];\r\n    };\r\n    ManejadorNivel.prototype.creaEscenarioNivel = function (jsonMapa, imagenScrolable, plataformaMovilID, velocidadPlataformaMovil) {\r\n        this.creaBandasonora();\r\n        this.creaMapaNivel(jsonMapa);\r\n        this.crearFondoScrolable(imagenScrolable);\r\n        this.creaAnimaciones();\r\n        this.creaJugador();\r\n        this.creaObjetoFinal();\r\n        this.creaPlataformasMoviles(plataformaMovilID, velocidadPlataformaMovil);\r\n    };\r\n    ManejadorNivel.prototype.creaBandasonora = function () {\r\n        var mibd = new GestorBD();\r\n        if (mibd.datos.musica) {\r\n            this.bandasonoraNivel = this.sound.add(Constantes.SONIDOS.BANDASONORA + 1, { loop: true, volume: 0 });\r\n            this.bandasonoraNivel.play();\r\n            this.tweens.add({\r\n                targets: this.bandasonoraNivel,\r\n                volume: 1,\r\n                duration: 2000\r\n            });\r\n        }\r\n    };\r\n    ManejadorNivel.prototype.creaMapaNivel = function (jsonMapa, imagenMapa) {\r\n        if (imagenMapa === void 0) { imagenMapa = Constantes.MAPAS.TILESET; }\r\n        this.mapaNivel = this.make.tilemap({ key: jsonMapa });\r\n        this.physics.world.bounds.setTo(0, 0, this.mapaNivel.widthInPixels, this.mapaNivel.heightInPixels);\r\n        this.conjuntoPatrones = this.mapaNivel.addTilesetImage(imagenMapa);\r\n        this.capaPlataformasMapaNivel = this.mapaNivel.createLayer(Constantes.MAPAS.CAPAPLATAFORMAS, this.conjuntoPatrones);\r\n        this.capaPlataformasMapaNivel.setCollisionByExclusion([-1]);\r\n    };\r\n    ManejadorNivel.prototype.crearFondoScrolable = function (imagenScrolable) {\r\n        this.imagenFondo = this.add.tileSprite(0, 0, this.mapaNivel.widthInPixels, this.mapaNivel.heightInPixels, imagenScrolable).setOrigin(0, 0).setDepth(-1);\r\n        this.nombreFondoNivel = imagenScrolable;\r\n    };\r\n    ManejadorNivel.prototype.creaAnimaciones = function () {\r\n        this.anims.create({\r\n            key: Constantes.JUGADOR.ANIMACION.ESPERA,\r\n            frames: this.anims.generateFrameNames(Constantes.JUGADOR.ID, {\r\n                prefix: Constantes.JUGADOR.ANIMACION.ESPERA + '-',\r\n                end: 10\r\n            }),\r\n            frameRate: 20,\r\n            repeat: -1\r\n        });\r\n        this.anims.create({\r\n            key: Constantes.JUGADOR.ANIMACION.CORRER,\r\n            frames: this.anims.generateFrameNames(Constantes.JUGADOR.ID, {\r\n                prefix: Constantes.JUGADOR.ANIMACION.CORRER + '-',\r\n                end: 11\r\n            }),\r\n            frameRate: 20,\r\n            repeat: -1\r\n        });\r\n        this.anims.create({\r\n            key: Constantes.ENEMIGOS.EXPLOSION.ANIM,\r\n            frames: Constantes.ENEMIGOS.EXPLOSION.ID,\r\n            frameRate: 15,\r\n            repeat: 0\r\n        });\r\n    };\r\n    ManejadorNivel.prototype.creaJugador = function () {\r\n        var _this = this;\r\n        this.mapaNivel.findObject(Constantes.JUGADOR.ID, function (d) {\r\n            _this.jugador = new Jugador({\r\n                escena: _this,\r\n                x: d.x,\r\n                y: d.y,\r\n                textura: Constantes.JUGADOR.ID\r\n            });\r\n        });\r\n        this.cameras.main.setBounds(0, 0, this.mapaNivel.widthInPixels, this.mapaNivel.heightInPixels);\r\n        this.cameras.main.startFollow(this.jugador);\r\n        this.physics.add.collider(this.jugador, this.capaPlataformasMapaNivel);\r\n    };\r\n    ManejadorNivel.prototype.creaObjetoFinal = function () {\r\n        var _this = this;\r\n        this.objetofinal = this.mapaNivel.createFromObjects(Constantes.MAPAS.POSICIONFINAL, { name: Constantes.MAPAS.POSICIONFINAL })[0];\r\n        this.physics.world.enable(this.objetofinal);\r\n        this.objetofinal.body.setAllowGravity(false);\r\n        this.objetofinal.setTexture(Constantes.OBJETOS.FINAL);\r\n        this.objetofinal.body.setImmovable(true);\r\n        this.objetofinal.body.setSize(40, 50);\r\n        this.objetofinal.body.setOffset(10, 15);\r\n        this.objetofinal.setAlpha(0);\r\n        this.objetofinalColision = this.physics.add.collider(this.jugador, this.objetofinal, function () { return _this.finalizaNivel(); });\r\n        this.objetofinalColision.active = false;\r\n    };\r\n    ManejadorNivel.prototype.volverAMenu = function () {\r\n        var _this = this;\r\n        this.cameras.main.fade(700, 0, 0, 0);\r\n        this.cameras.main.on('camerafadeoutcomplete', function () {\r\n            _this.sound.stopAll();\r\n            _this.scene.stop(_this.nombreNivel);\r\n            _this.scene.stop(Constantes.ESCENAS.HUD);\r\n            _this.scene.start(Constantes.ESCENAS.MENU);\r\n        });\r\n    };\r\n    ManejadorNivel.prototype.finalizaNivel = function (esWin) {\r\n        if (esWin === void 0) { esWin = true; }\r\n        this.sound.stopAll();\r\n        this.scene.stop(this.nombreNivel);\r\n        this.scene.stop(Constantes.ESCENAS.HUD);\r\n        this.scene.start(Constantes.ESCENAS.FINNIVEL, {\r\n            esWin: esWin,\r\n            nombreNivel: this.nombreNivel,\r\n            nombreFondoNivel: this.nombreFondoNivel,\r\n            puntuacion: this.puntuacion + this.tiempoRestante\r\n        });\r\n    };\r\n    ManejadorNivel.prototype.creaEnemigos = function (enemigosConfig) {\r\n        var _this = this;\r\n        enemigosConfig.forEach(function (enemigosConfig) {\r\n            var enemigos = new Enemigos(_this, Constantes.MAPAS.ENEMIGOS, enemigosConfig.ID, enemigosConfig.ANIM, enemigosConfig.VELOCIDAD);\r\n            _this.physics.add.collider(enemigos, _this.capaPlataformasMapaNivel);\r\n            _this.physics.add.overlap(_this.jugador, enemigos, _this.jugador.enemigoToca, null, _this);\r\n            _this.grupoEnemigos.push(enemigos);\r\n        });\r\n    };\r\n    ManejadorNivel.prototype.creaPlataformasMoviles = function (plataformaMovilID, velocidadPlataformaMovil) {\r\n        this.plataformasMovilesH = new PlataformasMoviles(this, Constantes.MAPAS.PLATAFORMASMOVILES, plataformaMovilID, velocidadPlataformaMovil, true);\r\n        this.plataformasMovilesV = new PlataformasMoviles(this, Constantes.MAPAS.PLATAFORMASMOVILES, plataformaMovilID, velocidadPlataformaMovil, false);\r\n        this.physics.add.collider(this.jugador, [this.plataformasMovilesH, this.plataformasMovilesV]);\r\n        this.physics.add.collider(this.capaPlataformasMapaNivel, [this.plataformasMovilesH, this.plataformasMovilesV]);\r\n    };\r\n    ManejadorNivel.prototype.creaRecolectables = function (recolectablesConfig) {\r\n        var _this = this;\r\n        recolectablesConfig.forEach(function (enemigosConfig) {\r\n            var recolectables = new Recolectables(_this, Constantes.MAPAS.RECOLECTABLES, enemigosConfig.ID, enemigosConfig.ANIM);\r\n            _this.physics.add.overlap(_this.jugador, recolectables, _this.jugador.recolecta, null, _this);\r\n        });\r\n        this.registry.set(Constantes.REGISTRO.OBJETOSRECOLECTAR, this.numObjetosRecolectar);\r\n    };\r\n    ManejadorNivel.prototype.update = function (time, delta) {\r\n        this.imagenFondo.tilePositionY -= 0.4;\r\n        this.jugador.update();\r\n        this.grupoEnemigos.forEach(function (enemigos) {\r\n            enemigos.update();\r\n        });\r\n        this.plataformasMovilesH.update();\r\n        this.plataformasMovilesV.update();\r\n        if ((this.segundos != Math.floor(Math.abs(time / 1000))) && !this.tiempoAgotado) {\r\n            this.segundos = Math.floor(Math.abs(time / 1000));\r\n            this.tiempoRestante--;\r\n            var minutos = Math.floor(this.tiempoRestante / 60);\r\n            var segundos = Math.floor(this.tiempoRestante - (minutos * 60));\r\n            var textoReloj = Phaser.Utils.String.Pad(minutos, 2, '0', 1) + \":\" + Phaser.Utils.String.Pad(segundos, 2, '0', 1);\r\n            this.registry.set(Constantes.REGISTRO.RELOJ, textoReloj);\r\n            this.events.emit(Constantes.EVENTOS.RELOJ);\r\n            if (this.tiempoRestante == 0) {\r\n                this.tiempoAgotado = true;\r\n            }\r\n        }\r\n        if (this.vidas === 0 || this.tiempoAgotado)\r\n            this.finalizaNivel(false);\r\n    };\r\n    return ManejadorNivel;\r\n}(Phaser.Scene));\r\nexport default ManejadorNivel;\r\n","references":["/home/smm/Documentos/Pharser/videojuego/v10/src/constantes.ts","/home/smm/Documentos/Pharser/videojuego/v10/src/gameobjects/jugador.ts","/home/smm/Documentos/Pharser/videojuego/v10/src/gameobjects/enemigos.ts","/home/smm/Documentos/Pharser/videojuego/v10/src/gameobjects/plataformasmoviles.ts","/home/smm/Documentos/Pharser/videojuego/v10/src/gameobjects/recolectables.ts","/home/smm/Documentos/Pharser/videojuego/v10/src/basedatos/gestorbd.ts"]}
